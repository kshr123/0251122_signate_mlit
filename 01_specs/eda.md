# EDAï¼ˆæ¢ç´¢çš„ãƒ‡ãƒ¼ã‚¿åˆ†æï¼‰ä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2025-11-23
**å¯¾è±¡**: LIFULL Ã— å›½åœŸäº¤é€šçœ ä¸å‹•ç”£å£²è²·ä¾¡æ ¼äºˆæ¸¬ã‚³ãƒ³ãƒš

---

## ğŸ¯ EDAã®ç›®çš„

1. ãƒ‡ãƒ¼ã‚¿ã®ç‰¹æ€§ã‚’ç†è§£ã™ã‚‹
2. ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®æ–¹é‡ã‚’æ±ºå®šã™ã‚‹
3. ãƒ¢ãƒ‡ãƒªãƒ³ã‚°æˆ¦ç•¥ã‚’ç«‹ã¦ã‚‹
4. ãƒ‡ãƒ¼ã‚¿å“è³ªä¸Šã®å•é¡Œã‚’ç™ºè¦‹ã™ã‚‹

---

## ğŸ“‹ EDAã§å®Ÿæ–½ã™ã‚‹åˆ†æï¼ˆ5ç¨®é¡ï¼‰

### 1. åˆæœŸãƒ‡ãƒ¼ã‚¿ç¢ºèª

**ç›®çš„**: ãƒ‡ãƒ¼ã‚¿ã®å…¨ä½“åƒã‚’æŠŠæ¡

**åˆ†æå†…å®¹**:
- ãƒ‡ãƒ¼ã‚¿å½¢çŠ¶ï¼ˆè¡Œæ•°ãƒ»åˆ—æ•°ï¼‰
- ã‚«ãƒ©ãƒ ä¸€è¦§ã¨ãƒ‡ãƒ¼ã‚¿å‹
- åŸºæœ¬çµ±è¨ˆé‡ï¼ˆå¹³å‡ã€ä¸­å¤®å€¤ã€æ¨™æº–åå·®ç­‰ï¼‰
- æ¬ æå€¤ã®å‰²åˆ
- ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤ã®æ•°

**å‡ºåŠ›**:
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒãƒªãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰
- æ¬ æå€¤ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆç”»åƒï¼‰
- ãƒ‡ãƒ¼ã‚¿å‹ã®åˆ†å¸ƒï¼ˆã‚°ãƒ©ãƒ•ï¼‰

---

### 2. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°åˆ†æ

**ç›®çš„**: äºˆæ¸¬å¯¾è±¡ã®åˆ†å¸ƒã¨ç‰¹æ€§ã‚’ç†è§£

**åˆ†æå†…å®¹**:
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°ã®åŸºæœ¬çµ±è¨ˆé‡
- åˆ†å¸ƒã®å¯è¦–åŒ–ï¼ˆãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã€ç®±ã²ã’å›³ï¼‰
- å¤–ã‚Œå€¤ã®æ¤œå‡ºï¼ˆIQRæ³•ã€Z-scoreæ³•ï¼‰
- æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆå¹´åˆ¥ãƒ»æœˆåˆ¥ï¼‰
- å¯¾æ•°å¤‰æ›å¾Œã®åˆ†å¸ƒ

**å‡ºåŠ›**:
- åˆ†å¸ƒã‚°ãƒ©ãƒ•ï¼ˆãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã€KDEï¼‰
- å¤–ã‚Œå€¤ãƒªã‚¹ãƒˆï¼ˆCSVï¼‰
- æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆ
- æ­£è¦æ€§æ¤œå®šçµæœ

**åˆ¤å®šåŸºæº–**:
- å¤–ã‚Œå€¤: `Q3 + 1.5 * IQR` ã‚’è¶…ãˆã‚‹å€¤
- æ­£è¦æ€§: Shapiro-Wilkæ¤œå®š på€¤ > 0.05

---

### 3. æ•°å€¤ç‰¹å¾´é‡ã®ç›¸é–¢åˆ†æ

**ç›®çš„**: ç‰¹å¾´é‡é–“ã®é–¢ä¿‚æ€§ã‚’æŠŠæ¡ã—ã€å¤šé‡å…±ç·šæ€§ã‚’æ¤œå‡º

**åˆ†æå†…å®¹**:
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°ã¨ã®ç›¸é–¢ï¼ˆãƒ”ã‚¢ã‚½ãƒ³ç›¸é–¢ä¿‚æ•°ï¼‰
- ç‰¹å¾´é‡é–“ã®ç›¸é–¢è¡Œåˆ—
- å¤šé‡å…±ç·šæ€§ã®ãƒã‚§ãƒƒã‚¯ï¼ˆ|ç›¸é–¢| > 0.8ï¼‰
- æ•£å¸ƒå›³ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆTOP 5ç‰¹å¾´é‡ï¼‰

**å‡ºåŠ›**:
- ç›¸é–¢ä¿‚æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆCSVï¼‰
- ç›¸é–¢è¡Œåˆ—ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆç”»åƒï¼‰
- é«˜ç›¸é–¢ãƒšã‚¢ãƒªã‚¹ãƒˆï¼ˆCSVï¼‰
- æ•£å¸ƒå›³ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆç”»åƒï¼‰

**åˆ¤å®šåŸºæº–**:
- é«˜ç›¸é–¢: `|ç›¸é–¢ä¿‚æ•°| > 0.8`
- ä¸­ç›¸é–¢: `0.5 < |ç›¸é–¢ä¿‚æ•°| <= 0.8`
- ä½ç›¸é–¢: `|ç›¸é–¢ä¿‚æ•°| <= 0.5`

---

### 4. ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°åˆ†æ

**ç›®çš„**: ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã®ç‰¹æ€§ã‚’æŠŠæ¡ã—ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥ã‚’æ±ºå®š

**åˆ†æå†…å®¹**:
- ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã®åˆ†é¡ï¼ˆä½/ä¸­/é«˜ï¼‰
- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°ã¨ã®é–¢ä¿‚æ€§ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥å¹³å‡å€¤ï¼‰
- Target EncodingåŠ¹æœã®äºˆæ¸¬ï¼ˆã‚«ãƒ†ã‚´ãƒªé–“ã®æ¨™æº–åå·®ï¼‰
- é »åº¦åˆ†å¸ƒ

**å‡ºåŠ›**:
- ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£åˆ¥ãƒªã‚¹ãƒˆï¼ˆCSVï¼‰
- ã‚«ãƒ†ã‚´ãƒªåˆ¥å¹³å‡ä¾¡æ ¼ï¼ˆã‚°ãƒ©ãƒ•ï¼‰
- Target Encodingå„ªå…ˆåº¦ãƒªã‚¹ãƒˆï¼ˆCSVï¼‰
- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥ãƒãƒƒãƒ—ï¼ˆCSVï¼‰

**åˆ¤å®šåŸºæº–**:
- ä½ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£: `ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•° < 10`
- ä¸­ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£: `10 <= ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•° <= 50`
- é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£: `ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•° > 50`

**ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ¨å¥¨**:
- ä½ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£: Label Encoding or ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚«ãƒ†ã‚´ãƒª
- ä¸­ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£: Label + Target Encoding
- é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£: Label + Target Encoding with CV

---

### 5. åœ°ç†ç©ºé–“ãƒ‡ãƒ¼ã‚¿åˆ†æ

**ç›®çš„**: ä½ç½®æƒ…å ±ã‹ã‚‰ç‰¹å¾´é‡ã‚’æŠ½å‡ºã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å¾—ã‚‹

**åˆ†æå†…å®¹**:
- ç·¯åº¦çµŒåº¦ã®åˆ†å¸ƒç¢ºèª
- åœ°ç†çš„ãªä¾¡æ ¼åˆ†å¸ƒï¼ˆæ•£å¸ƒå›³ã€ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‰
- ç‰©ä»¶å¯†åº¦ã®å¯è¦–åŒ–
- ã‚¨ãƒªã‚¢ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆK-meansï¼‰
- ä¸»è¦éƒ½å¸‚ã‹ã‚‰ã®è·é›¢è¨ˆç®—

**å‡ºåŠ›**:
- åœ°ç†çš„åˆ†å¸ƒãƒ—ãƒ­ãƒƒãƒˆï¼ˆç”»åƒï¼‰
- ä¾¡æ ¼ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆç”»åƒï¼‰
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†æçµæœï¼ˆCSVï¼‰
- ä¸»è¦éƒ½å¸‚åº§æ¨™ãƒªã‚¹ãƒˆï¼ˆCSVï¼‰

**ä¸»è¦éƒ½å¸‚å®šç¾©**:
- æ±äº¬é§…: (35.681236, 139.767125)
- æ–°å®¿é§…: (35.689592, 139.700464)
- æ¸‹è°·é§…: (35.658034, 139.701636)
- å¤§é˜ªé§…: (34.702485, 135.495951)
- åå¤å±‹é§…: (35.170915, 136.881537)
- ç¦å²¡é§…: (33.589542, 130.420841)

---

## ğŸ”§ å¿…è¦ãªé–¢æ•°ï¼ˆ04_src/eda/ã«å®Ÿè£…ï¼‰

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°

```python
def get_data_profile(df: pl.DataFrame) -> dict:
    """
    ãƒ‡ãƒ¼ã‚¿ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—

    Parameters
    ----------
    df : pl.DataFrame
        å¯¾è±¡ãƒ‡ãƒ¼ã‚¿

    Returns
    -------
    dict
        {
            'shape': (rows, cols),
            'columns': [...],
            'dtypes': {...},
            'missing': {...},
            'unique_counts': {...}
        }
    """
```

### 2. ç›¸é–¢è¨ˆç®—

```python
def calculate_correlations(
    df: pl.DataFrame,
    target_col: str,
    numeric_cols: list[str]
) -> pl.DataFrame:
    """
    ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°ã¨ã®ç›¸é–¢ã‚’è¨ˆç®—

    Parameters
    ----------
    df : pl.DataFrame
        ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ 
    target_col : str
        ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°å
    numeric_cols : list[str]
        æ•°å€¤ã‚«ãƒ©ãƒ ãƒªã‚¹ãƒˆ

    Returns
    -------
    pl.DataFrame
        columns: ['feature', 'correlation']
        sorted by abs(correlation) descending
    """
```

### 3. ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£åˆ†é¡

```python
def classify_cardinality(
    df: pl.DataFrame,
    categorical_cols: list[str]
) -> dict:
    """
    ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã‚’ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ã§åˆ†é¡

    Parameters
    ----------
    df : pl.DataFrame
        ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ 
    categorical_cols : list[str]
        ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ©ãƒ ãƒªã‚¹ãƒˆ

    Returns
    -------
    dict
        {
            'low': [(col, n_unique), ...],    # < 10
            'medium': [(col, n_unique), ...], # 10-50
            'high': [(col, n_unique), ...]    # > 50
        }
    """
```

### 4. Target EncodingåŠ¹æœäºˆæ¸¬

```python
def calculate_target_encoding_potential(
    df: pl.DataFrame,
    categorical_col: str,
    target_col: str
) -> float:
    """
    Target Encodingã®åŠ¹æœã‚’äºˆæ¸¬ï¼ˆã‚«ãƒ†ã‚´ãƒªé–“ã®æ¨™æº–åå·®ï¼‰

    Parameters
    ----------
    df : pl.DataFrame
        ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ 
    categorical_col : str
        ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ©ãƒ å
    target_col : str
        ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°å

    Returns
    -------
    float
        ã‚«ãƒ†ã‚´ãƒªåˆ¥å¹³å‡å€¤ã®æ¨™æº–åå·®ï¼ˆå¤§ãã„ã»ã©åŠ¹æœå¤§ï¼‰
    """
```

### 5. Haversineè·é›¢è¨ˆç®—

```python
def haversine_distance(
    lat1: float,
    lon1: float,
    lat2: float,
    lon2: float
) -> float:
    """
    2ç‚¹é–“ã®Haversineè·é›¢ï¼ˆkmï¼‰ã‚’è¨ˆç®—

    Parameters
    ----------
    lat1, lon1 : float
        åœ°ç‚¹1ã®ç·¯åº¦ãƒ»çµŒåº¦
    lat2, lon2 : float
        åœ°ç‚¹2ã®ç·¯åº¦ãƒ»çµŒåº¦

    Returns
    -------
    float
        è·é›¢ï¼ˆkmï¼‰
        å…¥åŠ›ã«NaNãŒå«ã¾ã‚Œã‚‹å ´åˆã¯NaNã‚’è¿”ã™

    Examples
    --------
    >>> haversine_distance(35.681236, 139.767125, 35.689592, 139.700464)
    7.123
    """
```

---

## âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ07_tests/test_eda/ï¼‰

### test_profiler.py

```python
def test_get_data_profile_shape():
    """ãƒ‡ãƒ¼ã‚¿å½¢çŠ¶ãŒæ­£ã—ãå–å¾—ã§ãã‚‹"""

def test_get_data_profile_missing():
    """æ¬ æå€¤ãŒæ­£ã—ãã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹"""

def test_get_data_profile_empty_df():
    """ç©ºã®DataFrameã§ã‚‚ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„"""
```

### test_correlation.py

```python
def test_calculate_correlations_returns_sorted():
    """ç›¸é–¢ä¿‚æ•°ãŒé™é †ã§ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹"""

def test_calculate_correlations_with_nan():
    """NaNå€¤ã‚’å«ã‚€ã‚«ãƒ©ãƒ ã§ã‚‚è¨ˆç®—ã§ãã‚‹"""

def test_calculate_correlations_all_same_value():
    """å…¨ã¦åŒã˜å€¤ã®å ´åˆã¯ç›¸é–¢=0"""
```

### test_categorical.py

```python
def test_classify_cardinality_low():
    """ä½ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãŒæ­£ã—ãåˆ†é¡ã•ã‚Œã‚‹"""

def test_classify_cardinality_medium():
    """ä¸­ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãŒæ­£ã—ãåˆ†é¡ã•ã‚Œã‚‹"""

def test_classify_cardinality_high():
    """é«˜ã‚«ãƒ¼ãƒ‡ã‚£ãƒŠãƒªãƒ†ã‚£ãŒæ­£ã—ãåˆ†é¡ã•ã‚Œã‚‹"""

def test_target_encoding_potential():
    """Target EncodingåŠ¹æœãŒè¨ˆç®—ã§ãã‚‹"""
```

### test_location.py

```python
def test_haversine_same_location():
    """åŒä¸€åœ°ç‚¹ã®è·é›¢ã¯0"""

def test_haversine_tokyo_shinjuku():
    """æ±äº¬é§…-æ–°å®¿é§…ã®è·é›¢ï¼ˆç´„7kmï¼‰"""

def test_haversine_with_nan():
    """NaNå…¥åŠ›ã¯NaNã‚’è¿”ã™"""

def test_haversine_southern_hemisphere():
    """å—åŠçƒã§ã‚‚å‹•ä½œ"""
```

---

## ğŸ“Š æˆæœç‰©

### 1. .pyãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ04_src/eda/ï¼‰

- `profiler.py`: ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°é–¢æ•°
- `correlation.py`: ç›¸é–¢åˆ†æé–¢æ•°
- `categorical.py`: ã‚«ãƒ†ã‚´ãƒªåˆ†æé–¢æ•°
- `location.py`: åœ°ç†ç©ºé–“åˆ†æé–¢æ•°

### 2. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ07_tests/test_eda/ï¼‰

- `test_profiler.py`
- `test_correlation.py`
- `test_categorical.py`
- `test_location.py`

### 3. Notebookï¼ˆ05_notebooks/01_eda/ï¼‰

- `01_initial_eda.ipynb`: åˆæœŸãƒ‡ãƒ¼ã‚¿ç¢ºèª
- `02_target_analysis.ipynb`: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¤‰æ•°åˆ†æ
- `03_feature_correlation.ipynb`: ç›¸é–¢åˆ†æ
- `04_categorical_analysis.ipynb`: ã‚«ãƒ†ã‚´ãƒªåˆ†æ
- `05_geospatial_analysis.ipynb`: åœ°ç†ç©ºé–“åˆ†æ

### 4. åˆ†æçµæœï¼ˆ05_notebooks/01_eda/outputs/ï¼‰

- `feature_target_correlations.csv`: ç›¸é–¢ä¿‚æ•°ãƒªã‚¹ãƒˆ
- `categorical_encoding_strategy.csv`: ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥
- `major_cities_coordinates.csv`: ä¸»è¦éƒ½å¸‚åº§æ¨™

---

## ğŸ¯ æˆåŠŸåŸºæº–

- [ ] å…¨ã¦ã®.pyé–¢æ•°ã«ãƒ†ã‚¹ãƒˆãŒå­˜åœ¨ã™ã‚‹
- [ ] pytestå®Ÿè¡Œæ™‚ã«å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [ ] å…¨ã¦ã®NotebookãŒã‚¨ãƒ©ãƒ¼ãªãå®Ÿè¡Œã§ãã‚‹
- [ ] EDAçµæœã‹ã‚‰ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®æ–¹é‡ãŒæ˜ç¢ºã«ãªã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿å“è³ªä¸Šã®å•é¡Œï¼ˆæ¬ æã€å¤–ã‚Œå€¤ç­‰ï¼‰ãŒå…¨ã¦æ¤œå‡ºã•ã‚Œã‚‹

---

**æœ€çµ‚æ›´æ–°**: 2025-11-23
