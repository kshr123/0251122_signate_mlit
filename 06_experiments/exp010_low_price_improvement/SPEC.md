# exp010 仕様書

低価格帯（特に広面積×築古）の予測精度改善のための特徴量設計。

---

## 背景・課題

exp009の分析で以下が判明：

| セグメント | 件数 | 割合 | MAPE |
|-----------|------|------|------|
| 全体 | 363,924 | 100% | 12.48% |
| 1000万以下 | 48,356 | 13.3% | 20.75% |
| 100㎡以上×35年以上 | 22,261 | 6.1% | 16.60% |
| 150㎡以上×45年以上 | 2,417 | 0.7% | 20.24% |

**根本原因**: モデルが「広面積×低地価」「広面積×築古」パターンの低単価物件を捉えられていない

---

## 追加特徴量（4次元）

### 1. `lp_area_value`（土地価値目安）

```
計算式: lp_price × house_area
意図: 「この面積×この地価 = 土地価値の目安」をモデルに明示
```

### 2. `area_age_category`（面積×築年数カテゴリ）

```python
area_age_category =
  2: 150㎡以上 × 45年以上（最も予測困難）
  1: 100㎡以上 × 35年以上（カテゴリ2以外）
  0: それ以外
```

### 3. `area_age_cat_te_pref`（カテゴリ×都道府県TE）

```
計算式: TE(y, group_by=[area_age_category, addr1_1])
意図: 「広×古」カテゴリの地域別価格傾向を学習
```

### 4. `area_age_cat_te_youto`（カテゴリ×用途地域TE）

```
計算式: TE(y, group_by=[area_age_category, land_youto])
意図: 「広×古」カテゴリの用途地域別価格傾向を学習
```

---

## 期待効果

| セグメント | 現状MAPE | 目標 |
|-----------|----------|------|
| 全体 | 12.53% | 12.3%以下 |
| 1000万以下 | 20.75% | 19%以下 |
| 100㎡以上×35年以上 | 16.60% | 15%以下 |

---

## 追加特徴量（Phase 2: 地価公示・距離系拡張）

### 5. 地価公示データ追加カラム

現在の地価公示結合で未使用のカラムを特徴量化：

| 特徴量名 | 元カラム | 変換 | 意図 |
|----------|----------|------|------|
| `lp_land_area` | 地積 | log変換 | 地価公示地点の面積（㎡） |
| `lp_station_dist` | 駅距離 | そのまま（m） | 地価公示地点の最寄駅距離 |
| `lp_fire_zone` | 防火区分/防火地域 | LabelEncoding | 防火地域区分（年度でカラム名異なる） |

**年度別カラム名**:
- 2019-2023: `防火区分`
- 2024: `防火地域`

**駅距離比率**:
```
station_dist_ratio = walk_distance1 / lp_station_dist
意図: 物件と地価公示地点の駅距離差を比率で表現
```

### 6. 距離系地域別比率

物件の距離・時間を地域平均と比較する特徴量：

| 対象カラム | 比率タイプ | 出力特徴量名 |
|------------|------------|--------------|
| `walk_time1` | 都道府県平均比 | `walk_time1_pref_ratio` |
| `walk_time1` | 市区町村平均比 | `walk_time1_city_ratio` |
| `total_access_time1` | 都道府県平均比 | `total_access_time1_pref_ratio` |
| `total_access_time1` | 市区町村平均比 | `total_access_time1_city_ratio` |

```
計算式: ratio = 物件値 / 地域平均値
意図: 地域内での相対的な駅近/駅遠を表現
```

---

## 実装上の注意

- TEは**OOF方式**を使用（データリーク防止）
- CVのfold分割はモデル学習と同じものを使用
- 未知カテゴリは全体平均で補完
- 地価公示の追加カラムは年度ごとに名称が異なる可能性があるため、YEAR_CONFIGで管理

---

**最終更新**: 2025-11-28
