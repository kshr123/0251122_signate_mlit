# 地価公示データ活用ガイド

## 概要

国土交通省が公開する地価公示データを外部データとして活用するためのガイド。
賃料予測モデルの特徴量として、エリアの地価情報を追加することで予測精度向上を目指す。

**データ形式**: 第3.3版（令和6年度）

---

## 1. データソース

### 取得元
- **国土数値情報ダウンロードサイト**: https://nlftp.mlit.go.jp/ksj/gml/datalist/KsjTmplt-L01-2024.html
- **データ形式**: CSV（Shift-JIS）
- **更新頻度**: 年1回（3月頃）
- **公式仕様書**: `L01-yyyyP-48-01.0a.html`（各データフォルダ内）

### 保存場所
```
data/external/landprice/
├── L01-2022P-48-01.0a/
│   └── L01-2022P-2K.csv
├── L01-2023P-48-01.0a/
│   └── L01-2023P-2K.csv
├── L01-2024P-48-01.0a/
│   └── L01-2024P-2K.csv
└── L01-2025P-48-01.0a/
    └── L01-2025P-2K.csv
```

### ファイル命名規則
- `L01-yyyyP-2K.csv`: 全国データ
- `L01-yyyyP-2K_xx.csv`: 都道府県別データ（xxは都道府県コード2桁）
- 例: `L01-2025P-2K_13.csv` = 東京都の令和7年データ

---

## 2. データ仕様

### 基本情報
| 年度 | ファイル名 | レコード数 | 当年価格カラム | カラム数 |
|------|-----------|-----------|---------------|---------|
| 2022 | L01-2022P-2K.csv | 25,993 | `Ｒ４価格`（全角） | 126 |
| 2023 | L01-2023P-2K.csv | 25,993 | `Ｒ５価格`（全角） | 128 |
| 2024 | L01-2024P-2K.csv | 25,994 | `価格R06`（半角） | 129 |
| 2025 | L01-2025P-2K.csv | 25,563 | `価格R07`（半角） | 131 |

### 読み込み方法
```python
import pandas as pd

# エンコーディングはShift-JIS
df = pd.read_csv(
    'data/external/landprice/L01-2025P-48-01.0a/L01-2025P-2K.csv',
    encoding='shift_jis'
)
```

### 注意: カラム名の不統一
- 2022-2023年: 全角表記（例: `Ｒ４価格`）
- 2024-2025年: 半角表記（例: `価格R06`）

---

## 3. カラム構成

### 全131列（2025年版）の分類

#### 位置情報（2列）
| カラム名 | 型 | 説明 | 値の例 |
|---------|-----|------|--------|
| 経度 | float | **経度を「秒」単位で表記** | 501376.613 |
| 緯度 | float | **緯度を「秒」単位で表記** | 154999.616 |

> **重要**: 座標は**日本測地系2011（JGD2011/世界測地系）**で、単位は**秒**。
>
> **変換例**: `501376.613秒 = 139°16′16.613″ = 139.2712816°`
>
> **変換式**: `度 = 秒 / 3600`

#### 識別情報（7列）
| カラム名 | 型 | 説明 | 値の例 |
|---------|-----|------|--------|
| 行政区域コード | int | 5桁（都道府県2桁+市区町村3桁） | 1101（札幌市中央区） |
| 番号用途区分 | int | 用途区分コード | 0 |
| 番号連番 | int | 連番 | 1 |
| 年度 | int | データ年度 | 2025 |

#### 所在地（3列）
| カラム名 | 型 | 説明 | 値の例 |
|---------|-----|------|--------|
| 標準地名 | str | 地点名 | 札幌中央 |
| 所在・地番 | str | 詳細住所 | 北海道　札幌市中央区大通西２８丁目２０３番１０ |
| 住居表示 | str | 住居表示 | 大通西２８−２−５ |

#### 土地属性（4列）
| カラム名 | 型 | 説明 | 値の範囲 |
|---------|-----|------|----------|
| 地積 | int | 土地面積（㎡） | 43〜1,117,453 |
| 土地形状 | str | 形状 | 台形、不整形など |
| 間口比率 | float | 間口/奥行比 | 0.0〜6.5 |
| 奥行比率 | float | 奥行/間口比 | 0.0〜10.0 |

#### 利用状況（7列）
| カラム名 | 型 | 説明 | 主な値 |
|---------|-----|------|--------|
| 利用現況 | str | 現在の利用状況 | 住宅(17,037), 店舗兼住宅(1,500), 店舗(1,498) |
| 利用区分 | int | 区分コード | 1(住宅), 2, 3, 4, 5 |
| 建物構造 | str | 構造種別 | W(木造), RC, S, SRC, LS, B |
| 地上階層 | int | 地上階数 | 0〜52 |
| 地下階層 | int | 地下階数 | 0〜6 |

#### 道路状況（7列）
| カラム名 | 型 | 説明 | 主な値 |
|---------|-----|------|--------|
| 前面道路区分 | str | 道路種別 | 市道、都道、国道など |
| 前面道路方位 | str | 道路の向き | 東、西、南、北など |
| 前面道路幅員 | float | 道路幅（m） | 0.0〜112.0 |
| 側道状況 | str | 側道有無 | _（なし）、あり |

#### 周辺環境（4列）
| カラム名 | 型 | 説明 | 値の例 |
|---------|-----|------|--------|
| 周辺土地利用 | str | 周辺状況の説明文 | 大規模住宅、領事館等が存する閑静な住宅地域 |
| 駅名 | str | 最寄駅 | 円山公園 |
| 駅距離 | int | 駅までの距離（m） | 0〜98,000 |

#### 都市計画（9列）
| カラム名 | 型 | 説明 | 主な値 |
|---------|-----|------|--------|
| 都市計画用途地域 | str | 用途地域 | 1住居, 1低専, 商業, 1中専など |
| 防火地域 | str | 防火指定 | _, 準防火, 防火 |
| 都市計画区分 | str | 区域区分 | 市街化, 非線引など |
| 高度地区 | str | 高度地区指定 | _ |
| 建蔽率 | int | 建蔽率（%） | 0〜80 |
| 容積率 | int | 容積率（%） | 0〜1,300 |

#### 価格関連（3列 + 時系列）
| カラム名 | 型 | 説明 | 値の範囲 |
|---------|-----|------|----------|
| 対前年変動率 | float | 前年比変動率（%） | -16.8〜48.8 |
| 共通地点 | int | 継続調査地点フラグ | 0, 1 |
| 選定年次フラグ | str | 各年の選定状況 | 43桁のフラグ文字列 |

#### 価格時系列（43列）
- `価格S58`〜`価格R07`: 昭和58年から令和7年までの公示価格（円/㎡）
- 値が0の場合は当該年度のデータなし

#### 属性移動（42列）
- `属性移動S59`〜`属性移動R07`: 各年の属性変更フラグ

---

## 4. 価格統計（2025年）

| 統計量 | 値 |
|--------|-----|
| レコード数 | 25,563 |
| 平均価格 | 275,222円/㎡ |
| 中央値 | 81,500円/㎡ |
| 最小値 | 470円/㎡ |
| 最大値 | 60,500,000円/㎡ |

### 年度別推移
| 年度 | 平均価格 | 中央値 | 最大値 |
|------|---------|--------|--------|
| 2022（R04） | 235,224円 | 76,000円 | 5,300万円 |
| 2023（R05） | 242,691円 | 77,900円 | 5,380万円 |
| 2024（R06） | 255,784円 | 79,500円 | 5,570万円 |
| 2025（R07） | 275,222円 | 81,500円 | 6,050万円 |

---

## 5. train/testデータとの結合

### 座標系の違い
| データ | 座標系 | 経度範囲 | 緯度範囲 |
|--------|--------|----------|----------|
| train/test | WGS84（度） | 127.6〜144.4 | 26.1〜43.9 |
| 地価公示 | 平面直角座標（m） | 446,937〜524,162 | 87,613〜163,519 |

### 座標変換方法
```python
import pyproj

# 平面直角座標系（系番号に応じて変更）→ WGS84
# 例: 第9系（関東）の場合
transformer = pyproj.Transformer.from_crs(
    "EPSG:6677",  # JGD2011 / 第9系
    "EPSG:4326",  # WGS84
    always_xy=True
)

# 変換
lon_wgs, lat_wgs = transformer.transform(x_plane, y_plane)
```

### 結合キー候補
1. **座標ベース（推奨）**: 最近傍の地価公示地点を探索
2. **行政区域ベース**: 市区町村単位で集計値を結合
3. **駅名ベース**: 最寄駅名でマッチング

---

## 6. 特徴量として活用可能なカラム

### train/testにない有用カラム
| カラム | 説明 | 活用案 |
|--------|------|--------|
| **価格R06/R07** | 公示地価 | 近隣地価として直接利用 |
| **対前年変動率** | 地価変動率 | エリアの成長性指標 |
| **前面道路幅員** | 道路幅 | 立地条件の定量化 |
| **前面道路区分** | 道路種別 | 交通利便性の指標 |
| **利用現況** | 周辺の土地利用 | エリア特性 |
| **防火地域** | 都市計画規制 | 建築制限の指標 |
| **高度地区** | 高度制限 | 建築制限の指標 |

### 集計特徴量案
- 近隣N件の地価平均/中央値/最大/最小
- 同一市区町村内の地価統計
- 半径Xm以内の地価統計
- 用途地域別の地価統計

---

## 7. サンプルコード

### データ読み込み
```python
import pandas as pd
from pathlib import Path

def load_landprice(year: int) -> pd.DataFrame:
    """地価公示データを読み込む"""
    base_path = Path('data/external/landprice')
    file_path = base_path / f'L01-{year}P-48-01.0a' / f'L01-{year}P-2K.csv'
    return pd.read_csv(file_path, encoding='shift_jis')

# 2024, 2025年データを読み込み
df_2024 = load_landprice(2024)
df_2025 = load_landprice(2025)
```

### 価格カラム名の取得
```python
def get_price_column(year: int) -> str:
    """年度に対応する価格カラム名を返す"""
    year_to_col = {
        2022: 'Ｒ４価格',  # 全角
        2023: 'Ｒ５価格',  # 全角
        2024: '価格R06',   # 半角
        2025: '価格R07',   # 半角
    }
    return year_to_col.get(year)
```

### 行政区域コードの分解
```python
def parse_admin_code(code: int) -> dict:
    """行政区域コード（5桁）を分解"""
    code_str = str(code).zfill(5)
    return {
        'prefecture_code': int(code_str[:2]),  # 都道府県コード
        'city_code': int(code_str[2:]),        # 市区町村コード
    }
```

---

## 8. 注意事項

1. **エンコーディング**: 必ず`encoding='shift_jis'`を指定
2. **座標変換**: 平面直角座標系の系番号は地域により異なる
3. **欠損値**: 価格が0の場合は当該年度のデータなし
4. **カラム名**: 2022-2023年と2024-2025年で表記が異なる
5. **データ更新**: 毎年3月頃に更新される

---

## 更新履歴
- 2025-11-26: 初版作成
